This page details setup instructions for code editors and debuggers when working with Blueprint.

# Debugger Support

JS Debugging support for Blueprint/Duktape is available in [Visual Studio Code](https://code.visualstudio.com/) using the [Duktape Debugger](https://marketplace.visualstudio.com/items?itemName=HaroldBrenes.duk-debug) extension. Currently this is the only debug client known to support the use of source maps when debugging JS bundles running under Blueprint/Duktape. If you become aware of other Duktape debug clients that may work well with Blueprint, please let us open an issue with the proposed debugger for us to investigate.

Blueprint provides an implementation of the Duktape debugging interface via `EcmascriptEngine::debuggerAttach` and `EcmascriptEngine::debuggerDetach`.

If you are using the `ReactApplicationRoot` class to manage your React app, Blueprint provides a debugging experience similar to that of React Native. 

In debug builds with `JUCE_DEBUG` defined, you can use the `CTRL-D/CMD-D` key command to trigger a call to `EcmascriptEngine::debuggerAttach`. This command blocks the UI and awaits connection from a debug client. You can then attach your debugger, continue execution and set breakpoints etc.  

To configure the Duktape Debugger extension for use with Blueprint, you will need to do the following:

* Download/Add the Duktape Debugger extension. See: https://code.visualstudio.com/docs/introvideos/extend

* Ensure you have compiled Blueprint and your application/plugin in debug mode with `JUCE_DEBUG` defined.

* Add a launch configuration for debugging. See: https://code.visualstudio.com/docs/editor/debugging#_launch-configurations

An example launch.json configuration for use with the `GainPlugin` example is provided below. Note that `localRoot` points to the root `workspaceFolder`. In this case we assume `workspaceFolder` to be `examples/GainPlugin/Source/jsui`. The `outDir` entry points to the build directory containing the compiled JS bundle file you wish to debug. This output directory should also contain the bundle's associated source map file (Required by the Duktape Debugger extension).

```
{
  "version": "0.2.0",
  "configurations": [
      {
          "name": "JSUI Debug Attach",
          "type": "duk",
          "request": "attach",
          "address": "localhost",
          "port": 9091,
          "localRoot": "${workspaceFolder}",
          "sourceMaps": true,
          "outDir": "${workspaceFolder}/build/js",
          "stopOnEntry": false,
          "debugLog": false
      }
   ] 
}
```

To ensure debugging works reliably, you need to ensure your source map has been generated by webpack using [devtool](https://webpack.js.org/configuration/devtool/). The following option should be added to the `output` key in your webpack configuration:

  `devtoolModuleFilenameTemplate`: 'webpack:///[absolute-resource-path]'

You also need to ensure that your bundle is not minified, this can be achieved by building your JS bundle with `webpack --mode=development`. In the case of the `GainPlugin` example this can be achieved by running `npm run start`.

The `webpack.config.js` template provided by Blueprint enables all of this for you. See: [[Starting a New Project|starting-a-new-project]].

Example `webpack.config.js`:

```
module.exports = {
  entry: './src/index.js',
  output: {
    path: __dirname + '/build/js',
    filename: 'main.js',
    sourceMapFilename: "[file].map",
    devtoolModuleFilenameTemplate: 'webpack:///[absolute-resource-path]'
  },
  devtool: "source-map",
  module: {
    rules: [
      {
        test: /\.(js|jsx)$/,
        exclude: /node_modules/,
        use: ['babel-loader']
      },
      {
        test: /\.svg$/,
        exclude: /node_modules/,
        use: ['svg-inline-loader']
      },
    ]
  },
}
```

To test debugging support using the `GainPlugin` example do the following:

* Open the `GainPlugin/Source/jsui` directory in Visual Studio Code.

* Add the `launch.json` configuration from above to your `.vscode` directory under `GainPlugin/Source/jsui`.

* Run `npm run start` in the `jsui` directory 

* Start the standalone plugin app in your IDE (i.e. Visual Studio/Xcode)

* Give the `GainPlugin`'s UI/PluginEditor focus and hit `CTRL-D` (Win) / `CMD-D` (Mac)

* Start the `JSUI Debug Attach` launch task from the VSCode debugger.

* Set some breakpoints, profit!


## Known Debugging Issues and Limitations

* There are occasional issues hitting a breakpoint for the very first time after attaching the VSCode debugger. This can be mitigated by setting the `stopOnEntry` key to `true` in your `launch.json` configuration.

* Debugging support is currently experimental and issues may occur from time to time whilst we refine the experience.


## Acknowledgements

Thanks to [harold-b](https://github.com/harold-b/vscode-duktape-debug) for his excellent extension. 